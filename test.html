<!DOCTYPE html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> 
circle {fill: lightblue; stroke: black;} 

#x_menu{
    position: absolute;
    left: 200px; top: 200px;
}

#y_menu{
    position: absolute;
    left: 20px; top: 20px;
}

#Slides{
    opacity: 0;
    position: absolute;
    text-align: center;
    width: 200px; height: 200px;
    background: green;
    border:black;
    border-width: 15px;
}
#SlidesText{
    opacity: 0;
    position: absolute;
    text-align: center;
    width: 190px; height: 90px;
    background: blue;
    border-color:black;
    border-width: 15px;
}
#ArrowBox{
    fill: lightgrey;
    stroke: black;
}
#NextButton{
    opacity: 1;
    position: absolute;
    text-align: center;
    width: 50px; height: 25px;
}

#PrevButton{
    opacity: 1;
    position: absolute;
    text-align: center;
    width: 50px; height: 25px;
}

</style>

<div id='x_menu'>
    <select id="x_drop"></select>
</div>

<div id='y_menu'>
    <select id="y_drop"></select>
</div>


<body onload='init()'>

<svg class='chart' width=1000 height=600></svg>

<div id='Slides' opacity=0 >
    <svg id='SlidesSVG'>
        <g transform="translate(0 25)">
            <path id="ArrowBox" d="M 0 0 Z" />
        </g>
    </svg>
    <div id='SlidesText' opacity=1 ></div>
    <button id=NextButton onclick="NextSlideClick()">Next</button>
    <button id=PrevButton onclick="PrevSlideClick()">Prev</button>
</div>



<script>

var data;

// init function for the page.  load data and setup initial config
async function init() {

// load data file
data = await d3.csv("https://hgp33.github.io/covid_exit_strategy_data/total_set_2020-07-12_min.csv");

// setup svg space
margin = 50;
svg = d3.select('svg')
width  = +svg.attr("width"),
height = +svg.attr("height");

// establish x and y params
x_name = 'TOTAL DEATHS'
y_name = 'TOTAL COVID+'

x_values = data.map(function(d){return d[x_name];})
y_values = data.map(function(d){return d[y_name];})

x_min = d3.min(x_values)
x_max = d3.max(x_values)

y_min = d3.min(y_values)
y_max = d3.max(y_values)

xdomain = [x_min, x_max];
xrange = [0,width-2*margin];
ydomain = [y_min, y_max]
yrange = [height-2*margin, 0];

d3.select('.chart').append('rect').attr('x', 0).attr('y', 0).attr('height', height).attr('width', width).style('fill','white')

if( x_min == 0){
    xs = d3.scaleLinear().domain(xdomain).range(xrange);
}
else{
    xs = d3.scaleLog().base(10).domain(xdomain).range(xrange);
}

if( y_min == 0 ){
    ys = d3.scaleLinear().domain(ydomain).range(yrange);
}
else{
    ys = d3.scaleLog().base(10).domain(ydomain).range(yrange);
}

mySlide = d3.select('#SlidesText')

d3.select('.chart').append('g')
    .attr('id', 'points')
    .attr('transform','translate('+margin+','+margin+')')
    .selectAll('circle')
    .data(data)
    .enter()
    .append('circle')
    .attr('cx', function(d,i){return xs(d[x_name]);})
    .attr('cy', function(d,i){return ys(d[y_name]);})
    .attr('r', 3);
    //.attr('r', function(d,i){return (2 + Number(d.EngineCylinders));});

d3.select('.chart').append('g')
    .attr('transform','translate('+margin+','+margin+')')
    //.call(d3.axisLeft(ys).tickValues(d3.range(1, 6000000 + 6000000/10, 6000000/10)).tickFormat(d3.format("~s")));
    .call(d3.axisLeft(ys).tickFormat(d3.format("~s")));

d3.select('.chart').append('g')
    .attr('transform','translate('+ margin +','+ (height-margin) + ')')
    //.call(d3.axisBottom(xs).tickValues(d3.range(1, 6000000 + 6000000/10, 6000000/10)).tickFormat(d3.format("~s")));
    .call(d3.axisBottom(xs).tickFormat(d3.format("~s")));

// start with slide 1
SlideOne();

// List of groups (here I have one group per column)
var xGroup = ["valueX", "valueB", "valueC"];
var yGroup = ["valueY", "valueB", "valueC"];

// add the options to the button
d3.select("#x_drop")
    .selectAll('myOptions')
    .data(xGroup)
    .enter()
    .append('option')
    .text(function (d) { return d; }) // text showed in the menu
    .attr("value", function (d) { return d; }); // corresponding value returned by the button


// When the button is changed, run the updateChart function
d3.select("#x_drop").on("change", function(d) {
    // recover the option that has been chosen
    var selectedOption = d3.select(this).property("value");
    // run the updateChart function with this selected option
    update(selectedOption);
});


// add the options to the button
d3.select("#y_drop")
    .selectAll('myOptions')
    .data(yGroup)
    .enter()
    .append('option')
    .text(function (d) { return d; }) // text showed in the menu
    .attr("value", function (d) { return d; }); // corresponding value returned by the button


// When the button is changed, run the updateChart function
d3.select("#y_drop").on("change", function(d) {
    // recover the option that has been chosen
    var selectedOption = d3.select(this).property("value");
    // run the updateChart function with this selected option
    update(selectedOption);
});


// A function that update the chart
function update(selectedGroup) {
    console.log(selectedGroup);
}

};


// Slide Box
var arrow_h  = 25;
var button_w = 50;
var t_margin = 5;

function SlideConfig(x, y, h, w, text){
    
    // duration time of transitions in and out
    dur = 500;

    d3.select('#Slides')
            .transition().duration(dur).style('opacity', 0)
            .transition().style('top', y + 'px').style('left', x+ 'px').style('width', w + 'px').style('height', h + arrow_h + 'px')
            .transition().duration(dur).style('opacity', 1);

    d3.select('#SlidesSVG').transition().duration(dur).on('end', function(){
        d3.select(this).attr('width', w).attr('height', h + arrow_h);
    })

    d3.select('#NextButton').transition().duration(dur).on('end', function(){
        d3.select(this).style('top', h-2*t_margin + 'px').style('left', w*0.5+10 + 'px')
    });

    d3.select('#PrevButton').transition().duration(dur).on('end', function(){
        d3.select(this).style('top', h-2*t_margin + 'px').style('left', w*0.5-button_w-10 + 'px')
    });

    d3.select('#ArrowBox').transition().duration(dur).on('end', function(){
        d3.select(this).attr('d', 'M0 0 L0 ' +h+' L'+w+' ' +h+' L'+w+' 0 L'+(w*0.5+15)+' 0 L'+(w*0.5)+' -'+arrow_h+' L'+(w*0.5-15)+' 0 Z')
    });

    d3.select('#SlidesText').transition().duration(dur).on('end', function(){
        d3.select(this).html(text)
        .style('top', arrow_h + t_margin + 'px').style('left', t_margin + 'px')
        .style('width', w-2*t_margin + 'px').style('height', h-2*t_margin + 'px')
        .transition()
        .style('opacity',1)
    });
};


function SlideOne(){
    SlideConfig(50, 125, 200, 400, "On this slide it will be what I want for slide 111111111111.");
};
function SlideTwo(){
    SlideConfig(20, 50, 300, 400, "On this slide it will be what I want for slide 22222222222.");
};
function SlideThree(){
    SlideConfig(456, 506, 200, 100, "On this slide it will be what I want for slide 3333333333.");
};
function SlideFour(){
    SlideConfig(256, 222, 200, 400, "On this slide it will be what I want for slide 4444444444.");
};
function SlideFive(){
    SlideConfig(126, 10, 200, 400, "On this slide it will be what I want for slide 55555555555.");
};

var slideNum = 1;

function NextSlideClick(){
    console.log('here is the click');
    console.log("Next clicked " + slideNum);
    if (slideNum == 1){
        SlideTwo();
        slideNum = 2;
    }
    else if (slideNum == 2){
        SlideThree();
        slideNum = 3;
    }
    else if (slideNum == 3){
        SlideFour();
        slideNum = 4;
    }
    else if (slideNum == 4){
        SlideFive();
        slideNum = 5;
    }
    else{
        SlideFinal();
        slideNum = 6;
    }
};

function PrevSlideClick(){
    if (slideNum == 2){
        SlideOne();
        slideNum = 1;
    }
    else if (slideNum == 3){
        SlideTwo();
        slideNum = 2;
    }
    else if (slideNum == 4){
        SlideThree();
        slideNum = 3;
    }
    else if (slideNum == 5){
        SlideFour();
        slideNum = 4;
    }
    else{
        SlideFive();
        slideNum = 5;
    }
};

</script>
</body>
</html>